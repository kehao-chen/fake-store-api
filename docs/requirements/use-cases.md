# 使用案例說明書

[← 返回文件中心](../README.md) | [需求文件](./README.md) | **使用案例**

## 文件資訊

- **版本**: 1.0.0
- **最後更新**: 2025-08-28
- **目標讀者**: 產品經理、開發者、測試工程師、業務人員
- **相關文件**: 
  - [功能需求](./functional.md)
  - [非功能需求](./non-functional.md)
  - [成功指標](./success-metrics.md)
  - [API 設計規格](../api/design-spec.md)

## 使用案例總覽

本文件描述 Fake Store API 系統的主要使用案例，涵蓋不同使用者角色的互動場景。

### 角色定義

| 角色 | 描述 | 權限 |
|------|------|------|
| **訪客** | 未登入的使用者 | 瀏覽產品、查看分類 |
| **註冊使用者** | 已註冊並登入的使用者 | 管理購物車、下訂單、查看歷史 |
| **管理員** | 系統管理人員 | 管理產品、查看所有訂單、系統設定 |
| **開發者** | API 整合開發者 | 使用 API Key 存取公開端點 |

## 核心使用案例

### UC-01: 瀏覽產品目錄

**主要參與者**: 訪客、註冊使用者
**前置條件**: 系統正常運作
**目標**: 使用者能夠瀏覽和搜尋產品

**基本流程**:
1. 使用者進入產品列表頁面
2. 系統顯示分頁產品列表（預設 20 筆）
3. 使用者可以：
   - 按分類篩選產品
   - 按價格範圍篩選
   - 搜尋產品名稱
   - 切換排序方式（價格、名稱、時間）
4. 系統即時更新顯示結果

**替代流程**:
- 3a. 無符合條件的產品
  - 系統顯示「無符合產品」訊息
- 3b. 系統錯誤
  - 顯示錯誤訊息並提供重試選項

**成功條件**: 使用者找到想要的產品

### UC-02: 查看產品詳情

**主要參與者**: 訪客、註冊使用者
**前置條件**: 產品存在於系統中
**目標**: 查看單一產品的完整資訊

**基本流程**:
1. 使用者點擊產品項目
2. 系統顯示產品詳細資訊：
   - 產品圖片
   - 名稱和描述
   - 價格
   - 庫存狀態
   - 產品分類
   - SKU 編號
3. 使用者可以選擇加入購物車（需登入）

**替代流程**:
- 2a. 產品不存在
  - 返回 404 錯誤頁面
- 3a. 未登入使用者點擊加入購物車
  - 導向登入頁面

**成功條件**: 使用者獲得完整產品資訊

### UC-03: 使用者註冊與登入

**主要參與者**: 訪客
**前置條件**: 無
**目標**: 建立新帳號或登入既有帳號

**基本流程 - 註冊**:
1. 訪客點擊「註冊」按鈕
2. 選擇註冊方式：
   - Google OAuth
   - GitHub OAuth
   - Email/密碼（教學用）
3. 完成授權或填寫註冊表單
4. 系統建立帳號並自動登入
5. 返回 JWT Token

**基本流程 - 登入**:
1. 訪客點擊「登入」按鈕
2. 選擇登入方式
3. 完成認證
4. 系統返回 JWT Token（有效期 15 分鐘）
5. 導向原始頁面或首頁

**替代流程**:
- 3a. 認證失敗
  - 顯示錯誤訊息
  - 允許重試
- 3b. OAuth 授權取消
  - 返回登入頁面

**成功條件**: 使用者成功登入系統

### UC-04: 管理購物車

**主要參與者**: 註冊使用者
**前置條件**: 使用者已登入
**目標**: 管理購物車中的商品

**基本流程 - 加入商品**:
1. 使用者在產品頁面點擊「加入購物車」
2. 選擇數量
3. 系統驗證：
   - 產品存在
   - 庫存充足
4. 將商品加入購物車
5. 顯示成功訊息和購物車摘要

**基本流程 - 修改數量**:
1. 使用者進入購物車頁面
2. 調整商品數量
3. 系統即時更新總金額
4. 儲存變更

**基本流程 - 移除商品**:
1. 使用者點擊移除按鈕
2. 確認移除
3. 系統更新購物車

**替代流程**:
- 3a. 庫存不足
  - 顯示可用庫存數量
  - 調整為最大可用數量
- 4a. Token 過期
  - 提示重新登入

**成功條件**: 購物車內容符合使用者需求

### UC-05: 結帳付款

**主要參與者**: 註冊使用者
**前置條件**: 購物車有商品
**目標**: 完成訂單並支付

**基本流程**:
1. 使用者點擊「結帳」按鈕
2. 系統驗證：
   - 購物車不為空
   - 所有商品庫存充足
3. 建立待支付訂單
4. 重導向至 Stripe 支付頁面
5. 使用者完成支付
6. Stripe 回調系統 Webhook
7. 系統更新訂單狀態
8. 扣減庫存
9. 清空購物車
10. 顯示訂單確認頁面

**替代流程**:
- 2a. 購物車為空
  - 顯示「購物車為空」訊息
- 2b. 商品缺貨
  - 標示缺貨商品
  - 允許移除或調整
- 5a. 支付失敗
  - 返回購物車頁面
  - 保留購物車內容
- 5b. 使用者取消支付
  - 返回購物車頁面

**成功條件**: 訂單建立並支付成功

### UC-06: 產品管理（管理員）

**主要參與者**: 管理員
**前置條件**: 管理員已登入
**目標**: 維護產品資料

**基本流程 - 新增產品**:
1. 管理員進入產品管理介面
2. 點擊「新增產品」
3. 填寫產品資訊：
   - 名稱、描述
   - 價格
   - 分類
   - 圖片 URL
   - SKU
   - 初始庫存
4. 提交表單
5. 系統驗證資料
6. 建立產品記錄

**基本流程 - 更新產品**:
1. 管理員選擇要編輯的產品
2. 修改產品資訊
3. 使用 PATCH 更新特定欄位
4. 系統驗證並更新

**基本流程 - 刪除產品**:
1. 管理員選擇要刪除的產品
2. 確認刪除操作
3. 系統執行軟刪除
4. 檢查關聯性（購物車、訂單）

**替代流程**:
- 3a. 資料驗證失敗
  - 顯示驗證錯誤
  - 保留輸入內容
- 4a. 產品在使用中
  - 警告訊息
  - 確認強制刪除

**成功條件**: 產品資料正確維護

### UC-07: 查看分類產品

**主要參與者**: 訪客、註冊使用者
**前置條件**: 分類存在
**目標**: 瀏覽特定分類下的產品

**基本流程**:
1. 使用者選擇產品分類
2. 系統顯示該分類的：
   - 分類名稱和描述
   - 產品列表
   - 產品數量統計
3. 使用者可以進一步篩選和排序

**替代流程**:
- 2a. 分類不存在
  - 返回 404 錯誤
- 2b. 分類無產品
  - 顯示「此分類暫無產品」

**成功條件**: 使用者找到分類中的產品

### UC-08: API 整合（開發者）

**主要參與者**: 開發者
**前置條件**: 擁有有效的 API Key
**目標**: 整合 API 到第三方應用

**基本流程**:
1. 開發者註冊獲得 API Key
2. 使用 API Key 認證（Bearer Token）
3. 呼叫公開 API 端點：
   - 產品列表
   - 產品詳情
   - 分類列表
4. 接收 JSON 格式回應
5. 處理分頁和錯誤

**替代流程**:
- 2a. API Key 無效
  - 返回 401 未授權
- 3a. 超過速率限制
  - 返回 429 錯誤
  - 包含重試時間

**成功條件**: 成功整合 API 功能

## 使用案例優先級

| 優先級 | 使用案例 | 業務價值 | 技術複雜度 |
|--------|----------|----------|------------|
| P0 | UC-01: 瀏覽產品 | 高 | 低 |
| P0 | UC-02: 查看詳情 | 高 | 低 |
| P0 | UC-03: 註冊登入 | 高 | 中 |
| P1 | UC-04: 管理購物車 | 高 | 中 |
| P1 | UC-05: 結帳付款 | 高 | 高 |
| P1 | UC-07: 分類瀏覽 | 中 | 低 |
| P2 | UC-06: 產品管理 | 中 | 中 |
| P3 | UC-08: API 整合 | 低 | 低 |

## 效能需求

### 回應時間要求
- 產品列表查詢: < 500ms
- 單一產品查詢: < 200ms
- 購物車操作: < 300ms
- 登入認證: < 1000ms
- 支付發起: < 2000ms

### 並發處理
- 支援 1000 個並發使用者
- 每秒 100 個 API 請求
- 購物車鎖定機制避免超賣

## 安全考量

1. **認證安全**
   - JWT Token 有效期 15 分鐘
   - Refresh Token 機制
   - OAuth2 PKCE 流程

2. **資料保護**
   - 密碼加密儲存
   - HTTPS 傳輸
   - SQL Injection 防護

3. **存取控制**
   - 角色基礎權限
   - API Key 速率限制
   - 管理功能雙重驗證

## 測試案例參考

每個使用案例都應包含以下測試：
- 正向路徑測試
- 負向路徑測試
- 邊界條件測試
- 效能測試
- 安全測試

詳細測試案例請參考[測試策略文件](../implementation/testing-strategy.md)。

## 相關文件

- [功能需求](./functional.md) - 詳細功能規格
- [非功能需求](./non-functional.md) - 系統品質要求
- [API 設計規格](../api/design-spec.md) - API 實作細節
- [系統架構](../architecture/c4-model.md) - 架構設計

---

*本文件是 Fake Store API 專案的一部分*

*最後更新: 2025-08-28*